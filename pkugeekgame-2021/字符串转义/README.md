# 字符串转义

栈上两块紧邻的0x80的空间ctx.input和ctx.escaped，输入保存到ctx.input后，循环复制每一位到ctx.escaped，而复制的停止条件是不为0。因此如果输入0x80个`1`，复制就会无限进行下去直到碰到栈底报错。

程序会解析转义符`\`，遇到时就跳过它复制其后面一位。因此在末尾的`\x00`前放置一个转义符，就可以在escaped里放一个0，就可以在复制时溢出到返回地址并且不会无限的复制下去。

越界写有了，下面就是构造信息泄露。

测试时发现输入0x80个`\`程序不会报错，调试发现这是因为在复制时每两个`\`其第一个会因为转义而消失，因此0x80个`\`复制到escaped后变成了0x40，0x40个变成0x20，循环下去指针最终会在escaped的第0x7f位的0停下。

因此信息泄露的思路就是，通过越界写，在escaped+0x7f后面的位置提前布置多个`\`，然后输入0x80个`\`，escaped全部+后面若干个字符就都是`\`了，就可以像用绳子和木桶在井里打水一样把需要泄露的信息拉上来。这样泄露到canary和elf地址后，构造一个pop rdi的gadget ret到后门，得到flag。